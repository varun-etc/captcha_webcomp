const ghpages = require('gh-pages');
const dotenv = require('dotenv');

/**
 * Access environmental variables
 */
dotenv.config();


function missingVariable(){
  const missing = false;
  if(!process.env.GITHUB_TOKEN ){
    console.log('\n GITHUB_TOKEN variable missing. For more information: https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line \n');
    missing = true;
  }
  if(!process.env.GITHUB_REPO){
    console.log('\n GITHUB_REPO variable missing. Exe: "IoT/se-icons.git" \n');
    missing = true;
  }
  return missing;
}

async function main() {
  try {
    // Make sure we configured the github info correctly in the env
    if (missingVariable()){
      console.log('\n Environment variable need to be correctly configured in .env file \n');
      process.exit(1);
    }

    ghpages.publish('docs', {
      repo: 'https://' + process.env.GITHUB_TOKEN + '@github.schneider-electric.com/' + process.env.GITHUB_REPO,
      silent: false
    }, function(e){
      console.log(e)
    });    

  } catch (err) {
    console.log('\n', err, '\n');
    process.exit(1);
  }
}

main();
