{"version":3,"file":"index.js","sources":["../dist-src/config.js","../dist-src/util.js","../dist-src/resolve-remote.js","../dist-src/rollup-plugin-remote-cdn.js","../dist-src/rollup-plugin-entrypoint-alias.js","../dist-src/rollup-plugin-stats.js","../dist-src/rollup-plugin-treeshake-inputs.js","../dist-src/scan-imports.js","../dist-src/stats-formatter.js","../dist-src/index.js"],"sourcesContent":["import path from 'path';\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { validate } from 'jsonschema';\nimport { all as merge } from 'deepmerge';\nconst CONFIG_NAME = 'snowpack';\n// default settings\nconst DEFAULT_CONFIG = {\n    dedupe: [],\n    installOptions: {\n        clean: false,\n        hash: false,\n        dest: 'web_modules',\n        exclude: ['**/__tests__/*', '**/*.@(spec|test).@(js|mjs)'],\n        externalPackage: [],\n        nomoduleOutput: 'app.nomodule.js',\n        optimize: false,\n        remoteUrl: 'https://cdn.pika.dev',\n        stat: false,\n        strict: false,\n        env: {},\n    },\n    rollup: { plugins: [] },\n};\nconst configSchema = {\n    type: 'object',\n    properties: {\n        source: { type: 'string' },\n        entrypoints: { type: 'array', items: { type: 'string' } },\n        // TODO: Array of strings data format is deprecated, remove for v2\n        webDependencies: {\n            type: ['array', 'object'],\n            additionalProperties: { type: 'string' },\n            items: { type: 'string' },\n        },\n        dedupe: {\n            type: 'array',\n            items: { type: 'string' },\n        },\n        namedExports: {\n            type: 'object',\n            additionalProperties: { type: 'array', items: { type: 'string' } },\n        },\n        installOptions: {\n            type: 'object',\n            properties: {\n                babel: { type: 'boolean' },\n                hash: { type: 'boolean' },\n                clean: { type: 'boolean' },\n                dest: { type: 'string' },\n                exclude: { type: 'array', items: { type: 'string' } },\n                externalPackage: { type: 'array', items: { type: 'string' } },\n                include: { type: 'string' },\n                nomodule: { type: 'string' },\n                nomoduleOutput: { type: 'string' },\n                optimize: { type: 'boolean' },\n                remotePackage: { type: 'array', items: { type: 'string' } },\n                remoteUrl: { type: 'string' },\n                sourceMap: { oneOf: [{ type: 'boolean' }, { type: 'string' }] },\n                stat: { type: 'boolean' },\n                strict: { type: 'boolean' },\n                env: {\n                    type: 'object',\n                    additionalProperties: {\n                        oneOf: [\n                            { id: 'EnvVarString', type: 'string' },\n                            { id: 'EnvVarNumber', type: 'number' },\n                            { id: 'EnvVarTrue', type: 'boolean', enum: [true] },\n                        ],\n                    },\n                },\n            },\n        },\n        rollup: {\n            type: 'object',\n            properties: {\n                plugins: { type: 'array', items: { type: 'object' } },\n            },\n        },\n    },\n};\n/**\n * Convert CLI flags to an incomplete Snowpack config representation.\n * We need to be careful about setting properties here if the flag value\n * is undefined, since the deep merge strategy would then overwrite good\n * defaults with 'undefined'.\n */\nfunction expandCliFlags(flags) {\n    const { source, env, help, version, ...installOptions } = flags;\n    const result = { installOptions };\n    if (source) {\n        result.source = source;\n    }\n    result.installOptions.env = (env || []).reduce((acc, id) => {\n        const index = id.indexOf('=');\n        const [key, val] = index > 0 ? [id.substr(0, index), id.substr(index + 1)] : [id, true];\n        acc[key] = val;\n        return acc;\n    }, {});\n    return result;\n}\n/** resolve --dest relative to cwd, and set the default \"source\" */\nfunction normalizeConfig(config) {\n    config.installOptions.dest = path.resolve(process.cwd(), config.installOptions.dest);\n    if (Array.isArray(config.webDependencies)) {\n        config.entrypoints = config.webDependencies;\n        delete config.webDependencies;\n    }\n    if (!config.source) {\n        const isDetailedObject = config.webDependencies && typeof config.webDependencies === 'object';\n        config.source = isDetailedObject ? 'pika' : 'local';\n    }\n    return config;\n}\nexport default function loadConfig(flags, pkgManifest) {\n    const cliConfig = expandCliFlags(flags);\n    const explorerSync = cosmiconfigSync(CONFIG_NAME, {\n        // only support these 3 types of config for now\n        searchPlaces: ['package.json', 'snowpack.config.js', 'snowpack.config.json'],\n        // don't support crawling up the folder tree:\n        stopDir: path.dirname(process.cwd()),\n    });\n    let result;\n    // if user specified --config path, load that\n    const errors = [];\n    if (flags.config) {\n        result = explorerSync.load(path.resolve(flags.config));\n        if (!result) {\n            errors.push(`Could not locate Snowpack config at ${flags.config}`);\n        }\n    }\n    else {\n        // if --config not given, try searching up the file tree\n        result = explorerSync.search();\n    }\n    // no config found\n    if (!result || !result.config || result.isEmpty) {\n        // if CLI flags present, apply those as overrides\n        return {\n            config: normalizeConfig(merge([\n                DEFAULT_CONFIG,\n                { webDependencies: pkgManifest.webDependencies },\n                cliConfig,\n            ])),\n            errors,\n        };\n    }\n    const config = result.config;\n    // validate against schema; throw helpful user if invalid\n    const validation = validate(config, configSchema, {\n        allowUnknownAttributes: false,\n        propertyName: CONFIG_NAME,\n    });\n    // if valid, apply config over defaults\n    const overwriteMerge = (destinationArray, sourceArray, options) => sourceArray;\n    const mergedConfig = merge([DEFAULT_CONFIG, { webDependencies: pkgManifest.webDependencies }, config, cliConfig], { arrayMerge: overwriteMerge });\n    // if CLI flags present, apply those as overrides\n    return {\n        config: normalizeConfig(mergedConfig),\n        errors: validation.errors.map((msg) => `${path.basename(result.filepath)}: ${msg.toString()}`),\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport got from 'got';\nimport cachedir from 'cachedir';\nexport const PIKA_CDN = `https://cdn.pika.dev`;\nexport const CACHE_DIR = cachedir('snowpack');\nexport const RESOURCE_CACHE = path.join(CACHE_DIR, 'pkg-cache-1.4');\nexport const HAS_CDN_HASH_REGEX = /\\-[a-zA-Z0-9]{16,}/;\nexport async function readLockfile(cwd) {\n    try {\n        var lockfileContents = fs.readFileSync(path.join(cwd, 'snowpack.lock.json'), {\n            encoding: 'utf8',\n        });\n    }\n    catch (err) {\n        // no lockfile found, ignore and continue\n        return null;\n    }\n    // If this fails, we actually do want to alert the user by throwing\n    return JSON.parse(lockfileContents);\n}\nexport async function writeLockfile(loc, importMap) {\n    const sortedImportMap = { imports: {} };\n    for (const key of Object.keys(importMap.imports).sort()) {\n        sortedImportMap.imports[key] = importMap.imports[key];\n    }\n    fs.writeFileSync(loc, JSON.stringify(sortedImportMap, undefined, 2), { encoding: 'utf8' });\n}\nexport function fetchCDNResource(resourceUrl) {\n    if (!resourceUrl.startsWith(PIKA_CDN)) {\n        resourceUrl = PIKA_CDN + resourceUrl;\n    }\n    return got(resourceUrl, {\n        headers: { 'user-agent': `snowpack/v1.4 (https://snowpack.dev)` },\n        throwHttpErrors: false,\n    });\n}\nexport function isTruthy(item) {\n    return Boolean(item);\n}\n/**\n * Given a package name, look for that package's package.json manifest.\n * Return both the manifestÂ location (if believed to exist) and the\n * manifest itself (if found).\n *\n * NOTE: You used to be able to require() a package.json file directly,\n * but now with export map support in Node v13 that's no longer possible.\n */\nexport function resolveDependencyManifest(dep, cwd) {\n    // Attempt #1: Resolve the dependency manifest normally. This works for most\n    // packages, but fails when the package defines an export map that doesn't\n    // include a package.json. If we detect that to be the reason for failure,\n    // move on to our custom implementation.\n    try {\n        const depManifest = require.resolve(`${dep}/package.json`, { paths: [cwd] });\n        return [depManifest, require(depManifest)];\n    }\n    catch (err) {\n        if ((err.code === 'MODULE_NOT_FOUND' || err.code === 'ERR_PACKAGE_PATH_NOT_EXPORTED') &&\n            err.message.includes(`'./package.json'`)) {\n            // its most likely an export map issue, move on to our manual resolver.\n            // TODO(03-2020): Remove MODULE_NOT_FOUND check (only needed for Node v13.1-v13.9).\n        }\n        else {\n            throw err;\n        }\n    }\n    // Attempt #2: Resolve the dependency manifest manually. This involves resolving\n    // the dep itself to find the entrypoint file, and then haphazardly replacing the\n    // file path within the package with a \"./package.json\" instead. It's not as\n    // thorough as Attempt #1, but it should work well until export maps become more\n    // established & move out of experimental mode.\n    let result = [null, null];\n    try {\n        const fullPath = require.resolve(dep, { paths: [cwd] });\n        // Strip everything after the package name to get the package root path\n        // NOTE: This find-replace is very gross, replace with something like upath.\n        const searchPath = `${path.sep}node_modules${path.sep}${dep.replace('/', path.sep)}`;\n        const indexOfSearch = fullPath.lastIndexOf(searchPath);\n        if (indexOfSearch >= 0) {\n            const manifestPath = fullPath.substring(0, indexOfSearch + searchPath.length + 1) + 'package.json';\n            result[0] = manifestPath;\n            const manifestStr = fs.readFileSync(manifestPath, { encoding: 'utf8' });\n            result[1] = JSON.parse(manifestStr);\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n    finally {\n        return result;\n    }\n}\n/**\n * If Rollup erred parsing a particular file, show suggestions based on its\n * file extension (note: lowercase is fine).\n */\nexport const MISSING_PLUGIN_SUGGESTIONS = {\n    '.css': 'Try installing rollup-plugin-postcss and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.svelte': 'Try installing rollup-plugin-svelte and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.vue': 'Try installing rollup-plugin-vue and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n};\n","import cacache from 'cacache';\nimport PQueue from 'p-queue';\nimport chalk from 'chalk';\nimport validatePackageName from 'validate-npm-package-name';\nimport { fetchCDNResource, PIKA_CDN, RESOURCE_CACHE } from './util.js';\n/**\n * Given an install specifier, attempt to resolve it from the CDN.\n * If no lockfile exists or if the entry is not found in the lockfile, attempt to resolve\n * it from the CDN directly. Otherwise, use the URL found in the lockfile and attempt to\n * check the local cache first.\n *\n * All resolved URLs are populated into the local cache, where our internal Rollup engine\n * will load them from when it installs your dependencies to disk.\n */\nasync function resolveDependency(installSpecifier, packageSemver, lockfile, canRetry = true) {\n    // Right now, the CDN is only for top-level JS packages. The CDN doesn't support CSS,\n    // non-JS assets, and has limited support for deep package imports. Snowpack\n    // will automatically fall-back any failed/not-found assets from local\n    // node_modules/ instead.\n    if (!validatePackageName(installSpecifier).validForNewPackages) {\n        return null;\n    }\n    // Grab the installUrl from our lockfile if it exists, otherwise resolve it yourself.\n    let installUrl;\n    let installUrlType;\n    if (lockfile && lockfile.imports[installSpecifier]) {\n        installUrl = lockfile.imports[installSpecifier];\n        installUrlType = 'pin';\n    }\n    else {\n        if (packageSemver === 'latest') {\n            console.warn(`warn(${installSpecifier}): Not found in \"dependencies\". Using latest package version...`);\n        }\n        if (packageSemver.startsWith('npm:@reactesm') || packageSemver.startsWith('npm:@pika/react')) {\n            throw new Error(`React workaround packages no longer needed! Revert to the official React & React-DOM packages.`);\n        }\n        if (packageSemver.includes(' ') || packageSemver.includes(':')) {\n            console.warn(`warn(${installSpecifier}): Can't fetch complex semver \"${packageSemver}\" from remote CDN.`);\n            return null;\n        }\n        installUrlType = 'lookup';\n        installUrl = `${PIKA_CDN}/${installSpecifier}@${packageSemver}`;\n    }\n    // Hashed CDN urls never change, so its safe to grab them directly from the local cache\n    // without a network request.\n    if (installUrlType === 'pin') {\n        const cachedResult = await cacache.get.info(RESOURCE_CACHE, installUrl).catch(() => null);\n        if (cachedResult) {\n            if (cachedResult.metadata) {\n                const { pinnedUrl } = cachedResult.metadata;\n                return pinnedUrl;\n            }\n        }\n    }\n    // Otherwise, resolve from the CDN remotely.\n    const { statusCode, headers, body } = await fetchCDNResource(installUrl);\n    if (statusCode !== 200) {\n        console.warn(`Failed to resolve [${statusCode}]: ${installUrl} (${body})`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    if (installUrlType === 'pin') {\n        const pinnedUrl = installUrl;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl },\n        });\n        return pinnedUrl;\n    }\n    let importUrlPath = headers['x-import-url'];\n    let pinnedUrlPath = headers['x-pinned-url'];\n    const buildStatus = headers['x-import-status'];\n    if (pinnedUrlPath) {\n        const pinnedUrl = `${PIKA_CDN}${pinnedUrlPath}`;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl },\n        });\n        return pinnedUrl;\n    }\n    if (buildStatus === 'SUCCESS') {\n        console.warn(`Failed to lookup [${statusCode}]: ${installUrl}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    if (!canRetry || buildStatus === 'FAIL') {\n        console.warn(`Failed to build: ${installSpecifier}@${packageSemver}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    console.log(chalk.cyan(`Building ${installSpecifier}@${packageSemver}... (This takes a moment, but will be cached for future use)`));\n    if (!importUrlPath) {\n        throw new Error('X-Import-URL header expected, but none received.');\n    }\n    const { statusCode: lookupStatusCode } = await fetchCDNResource(importUrlPath);\n    if (lookupStatusCode !== 200) {\n        throw new Error(`Unexpected response [${lookupStatusCode}]: ${PIKA_CDN}${importUrlPath}`);\n    }\n    return resolveDependency(installSpecifier, packageSemver, lockfile, false);\n}\nexport async function resolveTargetsFromRemoteCDN(installTargets, lockfile, pkgManifest, config) {\n    const downloadQueue = new PQueue({ concurrency: 16 });\n    const newLockfile = { imports: {} };\n    let resolutionError;\n    const allInstallSpecifiers = new Set(installTargets.map((dep) => dep.specifier));\n    for (const installSpecifier of allInstallSpecifiers) {\n        const installSemver = (config.webDependencies || {})[installSpecifier] ||\n            (pkgManifest.webDependencies || {})[installSpecifier] ||\n            (pkgManifest.dependencies || {})[installSpecifier] ||\n            (pkgManifest.devDependencies || {})[installSpecifier] ||\n            (pkgManifest.peerDependencies || {})[installSpecifier] ||\n            'latest';\n        downloadQueue.add(async () => {\n            try {\n                const resolvedUrl = await resolveDependency(installSpecifier, installSemver, lockfile);\n                if (resolvedUrl) {\n                    newLockfile.imports[installSpecifier] = resolvedUrl;\n                }\n            }\n            catch (err) {\n                resolutionError = resolutionError || err;\n            }\n        });\n    }\n    await downloadQueue.onIdle();\n    if (resolutionError) {\n        throw resolutionError;\n    }\n    return newLockfile;\n}\nexport function clearCache() {\n    return cacache.rm.all(RESOURCE_CACHE);\n}\n","import cacache from 'cacache';\nimport { RESOURCE_CACHE, fetchCDNResource, PIKA_CDN, HAS_CDN_HASH_REGEX } from './util';\nconst CACHED_FILE_ID_PREFIX = 'snowpack-pkg-cache:';\nconst PIKA_CDN_TRIM_LENGTH = PIKA_CDN.length;\n/**\n * rollup-plugin-remote-cdn\n *\n * Load import URLs from a remote CDN, sitting behind a local cache. The local\n * cache acts as a go-between for the resolve & load step: when we get back a\n * successful CDN resolution, we save the file to the local cache and then tell\n * rollup that it's safe to load from the cache in the `load()` hook.\n */\nexport function rollupPluginDependencyCache({ log }) {\n    return {\n        name: 'snowpack:rollup-plugin-remote-cdn',\n        async resolveId(source, importer) {\n            let cacheKey;\n            if (source.startsWith(PIKA_CDN)) {\n                cacheKey = source;\n            }\n            else if (source.startsWith('/-/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else if (source.startsWith('/pin/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else {\n                return null;\n            }\n            // If the source path is a CDNÂ path including a hash, it's assumed the\n            // file will never change and it is safe to pull from our local cache\n            // without a network request.\n            log(cacheKey);\n            if (HAS_CDN_HASH_REGEX.test(cacheKey)) {\n                const cachedResult = await cacache.get\n                    .info(RESOURCE_CACHE, cacheKey)\n                    .catch(( /* ignore */) => null);\n                if (cachedResult) {\n                    return CACHED_FILE_ID_PREFIX + cacheKey;\n                }\n            }\n            // Otherwise, make the remote request and cache the file on success.\n            const response = await fetchCDNResource(cacheKey);\n            if (response.statusCode === 200) {\n                await cacache.put(RESOURCE_CACHE, cacheKey, response.body);\n                return CACHED_FILE_ID_PREFIX + cacheKey;\n            }\n            // If lookup failed, skip this plugin and resolve the import locallyÂ instead.\n            // TODO: Log that this has happened (if some sort of verbose mode is enabled).\n            const packageName = cacheKey\n                .substring(PIKA_CDN_TRIM_LENGTH)\n                .replace('/-/', '')\n                .replace('/pin/', '')\n                .split('@')[0];\n            return this.resolve(packageName, importer, { skipSelf: true }).then((resolved) => {\n                let finalResult = resolved;\n                if (!finalResult) {\n                    finalResult = { id: packageName };\n                }\n                return finalResult;\n            });\n        },\n        async load(id) {\n            if (!id.startsWith(CACHED_FILE_ID_PREFIX)) {\n                return null;\n            }\n            const cacheKey = id.substring(CACHED_FILE_ID_PREFIX.length);\n            log(cacheKey);\n            const cachedResult = await cacache.get(RESOURCE_CACHE, cacheKey);\n            return cachedResult.data.toString('utf8');\n        },\n    };\n}\n","import path from 'path';\nimport { resolveDependencyManifest } from './util';\nconst IS_DEEP_PACKAGE_IMPORT = /^(@[\\w-]+\\/)?([\\w-]+)\\/(.*)/;\n/**\n * rollup-plugin-entrypoint-alias\n *\n * Aliases any deep imports from a package to the package name, so that\n * chunking can happen more accurately.\n *\n * Example: lit-element imports from both 'lit-html' & 'lit-html/lit-html.js'.\n * Even though both eventually resolve to the same place, without this plugin\n * we lose the ability to mark \"lit-html\" as an external package.\n */\nexport function rollupPluginEntrypointAlias({ cwd }) {\n    return {\n        name: 'snowpack:rollup-plugin-entrypoint-alias',\n        resolveId(source, importer) {\n            if (!IS_DEEP_PACKAGE_IMPORT.test(source)) {\n                return null;\n            }\n            const [, packageScope, packageName] = source.match(IS_DEEP_PACKAGE_IMPORT);\n            const packageFullName = packageScope ? `${packageScope}${packageName}` : packageName;\n            const [, manifest] = resolveDependencyManifest(packageFullName, cwd);\n            if (!manifest) {\n                return null;\n            }\n            let needsAlias = (typeof manifest.module === 'string' &&\n                source === path.posix.join(packageFullName, manifest.module)) ||\n                (typeof manifest.browser === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.browser)) ||\n                (typeof manifest.main === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.main));\n            if (!needsAlias) {\n                return null;\n            }\n            return this.resolve(packageFullName, importer, { skipSelf: true }).then((resolved) => {\n                return resolved || null;\n            });\n        },\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport zlib from 'zlib';\nexport function rollupPluginDependencyStats(cb) {\n    let outputDir;\n    let existingFileCache = {};\n    let statsSummary = {\n        direct: {},\n        common: {},\n    };\n    function buildExistingFileCache(bundle) {\n        for (let fileName of Object.keys(bundle)) {\n            const filePath = path.join(outputDir, fileName);\n            if (fs.existsSync(filePath)) {\n                const { size } = fs.statSync(filePath);\n                existingFileCache[fileName] = size;\n            }\n        }\n    }\n    function compareDependencies(files, type) {\n        for (let { fileName, contents } of files) {\n            const size = contents.byteLength;\n            statsSummary[type][fileName] = {\n                size: size,\n                gzip: zlib.gzipSync(contents).byteLength,\n                brotli: zlib.brotliCompressSync(contents).byteLength,\n            };\n            if (existingFileCache[fileName]) {\n                const delta = (size - existingFileCache[fileName]) / 1000;\n                statsSummary[type][fileName].delta = delta;\n            }\n        }\n    }\n    return {\n        generateBundle(options, bundle) {\n            outputDir = options.dir;\n            buildExistingFileCache(bundle);\n        },\n        writeBundle(options, bundle) {\n            const directDependencies = [];\n            const commonDependencies = [];\n            for (const [fileName, assetOrChunk] of Object.entries(bundle)) {\n                const raw = assetOrChunk.type === 'asset' ? assetOrChunk.source : assetOrChunk.code;\n                const contents = Buffer.isBuffer(raw)\n                    ? raw\n                    : typeof raw === 'string'\n                        ? Buffer.from(raw, 'utf8')\n                        : Buffer.from(raw);\n                if (fileName.startsWith('common')) {\n                    commonDependencies.push({ fileName, contents });\n                }\n                else {\n                    directDependencies.push({ fileName, contents });\n                }\n            }\n            compareDependencies(directDependencies, 'direct');\n            compareDependencies(commonDependencies, 'common');\n            cb(statsSummary);\n        },\n    };\n}\n","import path from 'path';\n/**\n * rollup-plugin-treeshake-inputs\n *\n * How it works:\n * 1. An array of \"install targets\" are passed in, describing all known imports + metadata.\n * 2. Known imports are marked for tree-shaking by appending 'pika-treeshake:' to the input value.\n * 3. On load, we return a false virtual file for all \"pika-treeshake:\" inputs.\n *    a. That virtual file contains only `export ... from 'ACTUAL_FILE_PATH';` exports\n *    b. Rollup uses those exports to drive its tree-shaking algorithm.\n */\nexport function rollupPluginTreeshakeInputs(allImports) {\n    const installTargetsByFile = {};\n    return {\n        name: 'snowpack:treeshake-inputs',\n        // Mark some inputs for tree-shaking.\n        options(inputOptions) {\n            const input = inputOptions.input;\n            for (const [key, val] of Object.entries(input)) {\n                installTargetsByFile[val] = allImports.filter((imp) => imp.specifier === key);\n                // If an input has known install targets, and none of those have \"all=true\", mark for treeshaking.\n                if (installTargetsByFile[val].length > 0 &&\n                    !installTargetsByFile[val].some((imp) => imp.all)) {\n                    input[key] = `pika-treeshake:${val}`;\n                }\n            }\n            return inputOptions;\n        },\n        resolveId(source) {\n            if (source.startsWith('pika-treeshake:')) {\n                return source;\n            }\n            return null;\n        },\n        load(id) {\n            if (!id.startsWith('pika-treeshake:')) {\n                return null;\n            }\n            const fileLoc = id.substring('pika-treeshake:'.length);\n            // Reduce all install targets into a single \"summarized\" install target.\n            const treeshakeSummary = installTargetsByFile[fileLoc].reduce((summary, imp) => {\n                summary.default = summary.default || imp.default;\n                summary.namespace = summary.namespace || imp.namespace;\n                summary.named = [...summary.named, ...imp.named];\n                return summary;\n            });\n            const uniqueNamedImports = new Set(treeshakeSummary.named);\n            const normalizedFileLoc = fileLoc.split(path.win32.sep).join(path.posix.sep);\n            const result = `\n        ${treeshakeSummary.namespace ? `export * from '${normalizedFileLoc}';` : ''}\n        ${treeshakeSummary.default\n                ? `import __pika_web_default_export_for_treeshaking__ from '${normalizedFileLoc}'; export default __pika_web_default_export_for_treeshaking__;`\n                : ''}\n        ${`export {${[...uniqueNamedImports].join(',')}} from '${normalizedFileLoc}';`}\n      `;\n            return result;\n        },\n    };\n}\n","import babel from '@babel/core';\nimport chalk from 'chalk';\nimport nodePath from 'path';\nimport fs from 'fs';\nimport glob from 'glob';\nimport validatePackageName from 'validate-npm-package-name';\nimport { init as initESModuleLexer, parse } from 'es-module-lexer';\nimport { isTruthy } from './util';\nconst WEB_MODULES_TOKEN = 'web_modules/';\nconst WEB_MODULES_TOKEN_LENGTH = WEB_MODULES_TOKEN.length;\n// [@\\w] - Match a word-character or @ (valid package name)\n// (?!.*(:\\/\\/)) - Ignore if previous match was a protocol (ex: http://)\nconst BARE_SPECIFIER_REGEX = /^[@\\w](?!.*(:\\/\\/))/;\nconst HAS_NAMED_IMPORTS_REGEX = /^[\\w\\s\\,]*\\{(.*)\\}/s;\nconst SPLIT_NAMED_IMPORTS_REGEX = /\\bas\\s+\\w+|,/s;\nconst DEFAULT_IMPORT_REGEX = /import\\s+(\\w)+(,\\s\\{[\\w\\s]*\\})?\\s+from/s;\nfunction stripJsExtension(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\nfunction createInstallTarget(specifier, all = true) {\n    return {\n        specifier,\n        all,\n        default: false,\n        namespace: false,\n        named: [],\n    };\n}\nfunction removeSpecifierQueryString(specifier) {\n    const queryStringIndex = specifier.indexOf('?');\n    if (queryStringIndex >= 0) {\n        specifier = specifier.substring(0, queryStringIndex);\n    }\n    return specifier;\n}\nfunction getWebModuleSpecifierFromCode(code, imp) {\n    if (imp.d > -1) {\n        return code.substring(imp.s + 1, imp.e - 1);\n    }\n    return code.substring(imp.s, imp.e);\n}\n/**\n * parses an import specifier, looking for a web modules to install. If a web module is not detected,\n * null is returned.\n */\nfunction parseWebModuleSpecifier(specifier) {\n    // If specifier is a \"bare module specifier\" (ie: package name) just return it directly\n    if (BARE_SPECIFIER_REGEX.test(specifier)) {\n        return specifier;\n    }\n    // Clean the specifier, remove any query params that may mess with matching\n    const cleanedSpecifier = removeSpecifierQueryString(specifier);\n    // Otherwise, check that it includes the \"web_modules/\" directory\n    const webModulesIndex = cleanedSpecifier.indexOf(WEB_MODULES_TOKEN);\n    if (webModulesIndex === -1) {\n        return null;\n    }\n    // Check if this matches `@scope/package.js` or `package.js` format.\n    // If it is, assume that this is a top-level pcakage that should be installed without the â.jsâ\n    const resolvedSpecifier = cleanedSpecifier.substring(webModulesIndex + WEB_MODULES_TOKEN_LENGTH);\n    const resolvedSpecifierWithoutExtension = stripJsExtension(resolvedSpecifier);\n    if (validatePackageName(resolvedSpecifierWithoutExtension).validForNewPackages) {\n        return resolvedSpecifierWithoutExtension;\n    }\n    // Otherwise, this is an explicit import to a file within a package.\n    return resolvedSpecifier;\n}\nfunction parseImportStatement(code, imp) {\n    const webModuleSpecifier = parseWebModuleSpecifier(getWebModuleSpecifierFromCode(code, imp));\n    if (!webModuleSpecifier) {\n        return null;\n    }\n    const importStatement = code.substring(imp.ss, imp.se);\n    const dynamicImport = imp.d > -1;\n    const defaultImport = !dynamicImport && DEFAULT_IMPORT_REGEX.test(importStatement);\n    const namespaceImport = !dynamicImport && importStatement.includes('*');\n    const namedImports = (importStatement.match(HAS_NAMED_IMPORTS_REGEX) || [, ''])[1]\n        .split(SPLIT_NAMED_IMPORTS_REGEX)\n        .map((name) => name.trim())\n        .filter(isTruthy);\n    return {\n        specifier: webModuleSpecifier,\n        all: dynamicImport,\n        default: defaultImport,\n        namespace: namespaceImport,\n        named: namedImports,\n    };\n}\nfunction getInstallTargetsForFile(code) {\n    const [imports] = parse(code) || [];\n    const allImports = imports\n        .map((imp) => parseImportStatement(code, imp))\n        .filter(isTruthy);\n    return allImports;\n}\nexport function scanDepList(depList, cwd) {\n    return depList\n        .map((whitelistItem) => {\n        if (!glob.hasMagic(whitelistItem)) {\n            return [createInstallTarget(whitelistItem, true)];\n        }\n        else {\n            const nodeModulesLoc = nodePath.join(cwd, 'node_modules');\n            return scanDepList(glob.sync(whitelistItem, { cwd: nodeModulesLoc, nodir: true }), cwd);\n        }\n    })\n        .reduce((flat, item) => flat.concat(item), []);\n}\nexport async function scanImports({ include, exclude }) {\n    await initESModuleLexer;\n    const includeFiles = glob.sync(include, { ignore: exclude, nodir: true });\n    if (!includeFiles.length) {\n        console.warn(`[SCAN ERROR]: No files matching \"${include}\"`);\n        return [];\n    }\n    // Scan every matched JS file for web dependency imports\n    const loadedFiles = await Promise.all(includeFiles.map(async (filePath) => {\n        // Our import scanner can handle normal JS & even TypeScript without a problem.\n        if (filePath.endsWith('.js') || filePath.endsWith('.mjs') || filePath.endsWith('.ts')) {\n            return fs.promises.readFile(filePath, 'utf-8');\n        }\n        // JSX breaks our import scanner, so we need to transform it before sending it to our scanner.\n        if (filePath.endsWith('.jsx') || filePath.endsWith('.tsx')) {\n            const result = await babel.transformFileAsync(filePath, {\n                plugins: [\n                    [require('@babel/plugin-transform-react-jsx'), { runtime: 'classic' }],\n                    [require('@babel/plugin-syntax-typescript'), { isTSX: true }],\n                ],\n                babelrc: false,\n                configFile: false,\n            });\n            return result && result.code;\n        }\n        console.warn(chalk.dim(`ignoring unsupported file \"${filePath}\"`));\n        return null;\n    }));\n    return loadedFiles\n        .filter((code) => !!code)\n        .map((code) => getInstallTargetsForFile(code))\n        .reduce((flat, item) => flat.concat(item), [])\n        .sort((impA, impB) => impA.specifier.localeCompare(impB.specifier));\n}\n","import chalk from 'chalk';\n/** The minimum width, in characters, of each size column */\nconst SIZE_COLUMN_WIDTH = 11;\n/** Generic Object.entries() alphabetical sort by keys. */\nfunction entriesSort([filenameA], [filenameB]) {\n    return filenameA.localeCompare(filenameB);\n}\n/** Pretty-prints number of bytes as \"XXX KB\" */\nfunction formatSize(size) {\n    let kb = Math.round((size / 1000) * 100) / 100;\n    if (kb >= 1000) {\n        kb = Math.floor(kb);\n    }\n    let color;\n    if (kb < 15) {\n        color = 'green';\n    }\n    else if (kb < 30) {\n        color = 'yellow';\n    }\n    else {\n        color = 'red';\n    }\n    return chalk[color](`${kb} KB`.padEnd(SIZE_COLUMN_WIDTH));\n}\nfunction formatDelta(delta) {\n    const kb = Math.round(delta * 100) / 100;\n    const color = delta > 0 ? 'red' : 'green';\n    return chalk[color](`Î ${delta > 0 ? '+' : ''}${kb} KB`);\n}\nfunction formatFileInfo(filename, stats, padEnd, isLastFile) {\n    const lineGlyph = chalk.dim(isLastFile ? 'ââ' : 'ââ');\n    const lineName = filename.padEnd(padEnd);\n    const fileStat = formatSize(stats.size);\n    const gzipStat = formatSize(stats.gzip);\n    const brotliStat = formatSize(stats.brotli);\n    const lineStat = fileStat + gzipStat + brotliStat;\n    let lineDelta = '';\n    if (stats.delta) {\n        lineDelta = chalk.dim('[') + formatDelta(stats.delta) + chalk.dim(']');\n    }\n    // Trim trailing whitespace (can mess with formatting), but keep indentation.\n    return `    ` + `${lineGlyph} ${lineName} ${lineStat} ${lineDelta}`.trim();\n}\nfunction formatFiles(files, padEnd) {\n    const strippedFiles = files.map(([filename, stats]) => [\n        filename.replace(/^common\\//, ''),\n        stats,\n    ]);\n    return strippedFiles\n        .map(([filename, stats], index) => formatFileInfo(filename, stats, padEnd, index >= files.length - 1))\n        .join('\\n');\n}\nexport function printStats(dependencyStats) {\n    let output = '';\n    const { direct, common } = dependencyStats;\n    const allDirect = Object.entries(direct).sort(entriesSort);\n    const allCommon = Object.entries(common).sort(entriesSort);\n    const maxFileNameLength = [...allCommon, ...allDirect].reduce((max, [filename]) => Math.max(filename.length, max), 'web_modules/'.length) + 1;\n    output +=\n        `  â¦¿ ${chalk.bold('web_modules/'.padEnd(maxFileNameLength + 4))}` +\n            chalk.bold.underline('size'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('gzip'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('brotli'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            `\\n`;\n    output += `${formatFiles(allDirect, maxFileNameLength)}\\n`;\n    if (Object.values(common).length > 0) {\n        output += `  â¦¿ ${chalk.bold('web_modules/common/ (Shared)')}\\n`;\n        output += `${formatFiles(allCommon, maxFileNameLength)}\\n`;\n    }\n    return `\\n${output}\\n`;\n}\n","import babelPresetEnv from '@babel/preset-env';\nimport rollupPluginCommonjs from '@rollup/plugin-commonjs';\nimport rollupPluginJson from '@rollup/plugin-json';\nimport rollupPluginNodeResolve from '@rollup/plugin-node-resolve';\nimport rollupPluginReplace from '@rollup/plugin-replace';\nimport chalk from 'chalk';\nimport fs from 'fs';\nimport hasha from 'hasha';\nimport isNodeBuiltin from 'is-builtin-module';\nimport mkdirp from 'mkdirp';\nimport ora from 'ora';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport { rollup } from 'rollup';\nimport rollupPluginBabel from 'rollup-plugin-babel';\nimport { terser as rollupPluginTerser } from 'rollup-plugin-terser';\nimport validatePackageName from 'validate-npm-package-name';\nimport yargs from 'yargs-parser';\nimport loadConfig from './config.js';\nimport { resolveTargetsFromRemoteCDN, clearCache } from './resolve-remote.js';\nimport { rollupPluginDependencyCache } from './rollup-plugin-remote-cdn.js';\nimport { rollupPluginEntrypointAlias } from './rollup-plugin-entrypoint-alias.js';\nimport { rollupPluginDependencyStats } from './rollup-plugin-stats.js';\nimport { rollupPluginTreeshakeInputs } from './rollup-plugin-treeshake-inputs.js';\nimport { scanDepList, scanImports } from './scan-imports.js';\nimport { printStats } from './stats-formatter.js';\nimport { isTruthy, MISSING_PLUGIN_SUGGESTIONS, readLockfile, resolveDependencyManifest, writeLockfile, } from './util.js';\nconst ALWAYS_SHOW_ERRORS = new Set(['react', 'react-dom']);\nconst cwd = process.cwd();\nconst banner = chalk.bold(`snowpack`) + ` installing... `;\nconst installResults = [];\nlet dependencyStats = null;\nlet spinner = ora(banner);\nlet spinnerHasError = false;\nfunction printHelp() {\n    console.log(`\n${chalk.bold(`snowpack`)} - Install npm dependencies to run natively on the web.\n${chalk.bold('Options:')}\n  --dest [path]             Specify destination directory (default: \"web_modules/\").\n  --clean                   Clear out the destination directory before install.\n  --optimize                Transpile, minify, and optimize installed dependencies for production.\n  --env                     Set environment variable(s) inside dependencies:\n                                - if only NAME given, reads value from real env var\n                                - if \\`NAME=value\\`, uses given value\n                                - NODE_ENV defaults to \"production\" with \"--optimize\" (overridable)\n  --babel                   Transpile installed dependencies. Also enabled with \"--optimize\".\n  --include [glob]          Auto-detect imports from file(s). Supports glob.\n  --exclude [glob]          Exclude files from --include. Follows globâs ignore pattern.\n  --config [path]           Location of Snowpack config file.\n  --strict                  Only install pure ESM dependency trees. Fail if a CJS module is encountered.\n  --no-source-map           Skip emitting source map files (.js.map) into dest\n  --stat                    Logs install statistics after installing, with information on install targets and file sizes. Useful for CI, performance review.\n  --nomodule [path]         Your appâs entry file for generating a <script nomodule> bundle\n  --nomodule-output [path]  Filename for nomodule output (default: \"app.nomodule.js\")\n    ${chalk.bold('Advanced:')}\n  --external-package [val]  Internal use only, may be removed at any time.\n    `.trim());\n}\nasync function generateHashFromFile(targetLoc) {\n    const longHash = await hasha.fromFile(targetLoc, { algorithm: 'md5' });\n    return longHash?.slice(0, 10);\n}\nfunction formatInstallResults(skipFailures) {\n    return installResults\n        .map(([d, result]) => {\n        if (result === 'SUCCESS') {\n            return chalk.green(d);\n        }\n        if (result === 'ASSET') {\n            return chalk.yellow(d);\n        }\n        if (result === 'FAIL') {\n            return skipFailures ? chalk.dim(d) : chalk.red(d);\n        }\n        return d;\n    })\n        .join(', ');\n}\nfunction logError(msg) {\n    if (!spinnerHasError) {\n        spinner.stopAndPersist({ symbol: chalk.cyan('â ¼') });\n    }\n    spinnerHasError = true;\n    spinner = ora(chalk.red(msg));\n    spinner.fail();\n}\nfunction logUpdate(msg) {\n    spinner.text = banner + msg;\n}\nclass ErrorWithHint extends Error {\n    constructor(message, hint) {\n        super(message);\n        this.hint = hint;\n    }\n}\n// Add common, well-used non-esm packages here so that Rollup doesn't die trying to analyze them.\nconst PACKAGES_TO_AUTO_DETECT_EXPORTS = [\n    path.join('react', 'index.js'),\n    path.join('react-dom', 'index.js'),\n    'react-is',\n    'prop-types',\n    'scheduler',\n    'rxjs',\n    'exenv',\n    'body-scroll-lock',\n];\nfunction detectExports(filePath) {\n    try {\n        const fileLoc = require.resolve(filePath, { paths: [cwd] });\n        if (fs.existsSync(fileLoc)) {\n            return Object.keys(require(fileLoc)).filter((e) => e[0] !== '_');\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n}\n/**\n * Resolve a \"webDependencies\" input value to the correct absolute file location.\n * Supports both npm package names, and file paths relative to the node_modules directory.\n * Follows logic similar to Node's resolution logic, but using a package.json's ESM \"module\"\n * field instead of the CJS \"main\" field.\n */\nfunction resolveWebDependency(dep, isExplicit) {\n    // if dep includes a file extension, check that dep isn't a package before returning\n    if (path.extname(dep) && !validatePackageName(dep).validForNewPackages) {\n        const isJSFile = ['.js', '.mjs', '.cjs'].includes(path.extname(dep));\n        return {\n            type: isJSFile ? 'JS' : 'ASSET',\n            loc: require.resolve(dep, { paths: [cwd] }),\n        };\n    }\n    const [depManifestLoc, depManifest] = resolveDependencyManifest(dep, cwd);\n    if (!depManifest) {\n        throw new ErrorWithHint(`\"${dep}\" not found. Have you installed the package via npm?`, depManifestLoc && chalk.italic(depManifestLoc));\n    }\n    let foundEntrypoint = depManifest['browser:module'] ||\n        depManifest.module ||\n        depManifest['main:esnext'] ||\n        depManifest.browser;\n    // Some packages define \"browser\" as an object. We'll do our best to find the\n    // right entrypoint in an entrypoint object, or fail otherwise.\n    // See: https://github.com/defunctzombie/package-browser-field-spec\n    if (typeof foundEntrypoint === 'object') {\n        foundEntrypoint =\n            foundEntrypoint[dep] ||\n                foundEntrypoint['./index.js'] ||\n                foundEntrypoint['./index'] ||\n                foundEntrypoint['./'] ||\n                foundEntrypoint['.'];\n    }\n    // If the package was a part of the explicit whitelist, fallback to it's main CJS entrypoint.\n    if (!foundEntrypoint && isExplicit) {\n        foundEntrypoint = depManifest.main || 'index.js';\n    }\n    if ((dep === 'react' || dep === 'react-dom') &&\n        (!foundEntrypoint || foundEntrypoint === 'index.js')) {\n        throw new ErrorWithHint(chalk.bold(`Dependency \"${dep}\" has no native \"module\" entrypoint.`) +\n            `\n  To continue, install our drop-in, ESM-ready builds of \"react\" & \"react-dom\" to your project:\n    npm: npm install react@npm:@pika/react react-dom@npm:@pika/react-dom\n    yarn: yarn add react@npm:@pika/react react-dom@npm:@pika/react-dom`, chalk.italic(`See ${chalk.underline('https://www.snowpack.dev/#react')} for more info.`));\n    }\n    if (!foundEntrypoint) {\n        throw new ErrorWithHint(`dependency \"${dep}\" has no native \"module\" entrypoint.`, chalk.italic(`Tip: Find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n    }\n    if (typeof foundEntrypoint !== 'string') {\n        throw new Error(`\"${dep}\" has unexpected entrypoint: ${JSON.stringify(foundEntrypoint)}.`);\n    }\n    return {\n        type: 'JS',\n        loc: path.join(depManifestLoc, '..', foundEntrypoint),\n    };\n}\n/**\n * Formats the snowpack dependency name from a \"webDependencies\" input value:\n * 2. Remove any \".js\"/\".mjs\" extension (will be added automatically by Rollup)\n */\nfunction getWebDependencyName(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\n/**\n * Takes object of env var mappings and converts it to actual\n * replacement specs as expected by @rollup/plugin-replace. The\n * `optimize` arg is used to derive NODE_ENV default.\n *\n * @param env\n * @param optimize\n */\nfunction getRollupReplaceKeys(env, optimize) {\n    const result = Object.keys(env).reduce((acc, id) => {\n        const val = env[id];\n        acc[`process.env.${id}`] = `\"${val === true ? process.env[id] : val}\"`;\n        return acc;\n    }, {\n        'process.env.NODE_ENV': optimize ? '\"production\"' : '\"development\"',\n        'process.env.': '({}).',\n    });\n    return result;\n}\nexport async function install(installTargets, { hasBrowserlistConfig, isExplicit, lockfile }, config) {\n    const { dedupe, namedExports, source, installOptions: { babel: isBabel, dest: destLoc, hash: useHash, externalPackage: externalPackages, nomodule, nomoduleOutput, optimize: isOptimized, sourceMap, strict: isStrict, stat: withStats, env, }, rollup: userDefinedRollup, } = config;\n    const knownNamedExports = { ...namedExports };\n    for (const filePath of PACKAGES_TO_AUTO_DETECT_EXPORTS) {\n        knownNamedExports[filePath] = knownNamedExports[filePath] || detectExports(filePath) || [];\n    }\n    if (source === 'local' && !fs.existsSync(path.join(cwd, 'node_modules'))) {\n        logError('no \"node_modules\" directory exists. Did you run \"npm install\" first?');\n        return;\n    }\n    const allInstallSpecifiers = new Set(installTargets.map((dep) => dep.specifier).sort());\n    const installEntrypoints = {};\n    const assetEntrypoints = {};\n    const importMap = { imports: {} };\n    const installTargetsMap = {};\n    const skipFailures = !isExplicit;\n    for (const installSpecifier of allInstallSpecifiers) {\n        const targetName = getWebDependencyName(installSpecifier);\n        if (lockfile && lockfile.imports[installSpecifier]) {\n            installEntrypoints[targetName] = lockfile.imports[installSpecifier];\n            importMap.imports[installSpecifier] = `./${targetName}.js`;\n            installResults.push([targetName, 'SUCCESS']);\n            logUpdate(formatInstallResults(skipFailures));\n            continue;\n        }\n        try {\n            const { type: targetType, loc: targetLoc } = resolveWebDependency(installSpecifier, isExplicit);\n            if (targetType === 'JS') {\n                const hashQs = useHash ? `?rev=${await generateHashFromFile(targetLoc)}` : '';\n                installEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${targetName}.js${hashQs}`;\n                installTargetsMap[targetLoc] = installTargets.filter((t) => installSpecifier === t.specifier);\n                installResults.push([installSpecifier, 'SUCCESS']);\n            }\n            else if (targetType === 'ASSET') {\n                assetEntrypoints[targetName] = targetLoc;\n                installResults.push([installSpecifier, 'ASSET']);\n            }\n            logUpdate(formatInstallResults(skipFailures));\n        }\n        catch (err) {\n            installResults.push([installSpecifier, 'FAIL']);\n            logUpdate(formatInstallResults(skipFailures));\n            if (skipFailures && !ALWAYS_SHOW_ERRORS.has(installSpecifier)) {\n                continue;\n            }\n            // An error occurred! Log it.\n            logError(err.message || err);\n            if (err.hint) {\n                // Note: Wait 1ms to guarantee a log message after the spinner\n                setTimeout(() => console.log(err.hint), 1);\n            }\n            return false;\n        }\n    }\n    if (Object.keys(installEntrypoints).length === 0 && Object.keys(assetEntrypoints).length === 0) {\n        logError(`No ESM dependencies found!`);\n        console.log(chalk.dim(`  At least one dependency must have an ESM \"module\" entrypoint. You can find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n        return false;\n    }\n    const inputOptions = {\n        input: installEntrypoints,\n        external: externalPackages,\n        treeshake: { moduleSideEffects: 'no-external' },\n        plugins: [\n            !isStrict && rollupPluginReplace(getRollupReplaceKeys(env, isOptimized)),\n            rollupPluginEntrypointAlias({ cwd }),\n            source === 'pika' && rollupPluginDependencyCache({ log: (url) => logUpdate(chalk.dim(url)) }),\n            rollupPluginNodeResolve({\n                mainFields: ['browser:module', 'module', 'browser', !isStrict && 'main'].filter(isTruthy),\n                modulesOnly: isStrict,\n                extensions: ['.mjs', '.cjs', '.js', '.json'],\n                // whether to prefer built-in modules (e.g. `fs`, `path`) or local ones with the same names\n                preferBuiltins: false,\n                dedupe,\n            }),\n            !isStrict &&\n                rollupPluginJson({\n                    preferConst: true,\n                    indent: '  ',\n                    compact: isOptimized,\n                    namedExports: true,\n                }),\n            !isStrict &&\n                rollupPluginCommonjs({\n                    extensions: ['.js', '.cjs'],\n                    namedExports: knownNamedExports,\n                }),\n            !!isBabel &&\n                rollupPluginBabel({\n                    compact: false,\n                    babelrc: false,\n                    configFile: false,\n                    presets: [\n                        [\n                            babelPresetEnv,\n                            {\n                                modules: false,\n                                targets: hasBrowserlistConfig\n                                    ? undefined\n                                    : '>0.75%, not ie 11, not UCAndroid >0, not OperaMini all',\n                            },\n                        ],\n                    ],\n                }),\n            !!isOptimized && rollupPluginTreeshakeInputs(installTargets),\n            !!isOptimized && rollupPluginTerser(),\n            !!withStats && rollupPluginDependencyStats((info) => (dependencyStats = info)),\n            ...userDefinedRollup.plugins,\n        ],\n        onwarn(warning, warn) {\n            if (warning.code === 'UNRESOLVED_IMPORT') {\n                logError(`'${warning.source}' is imported by '${warning.importer}', but could not be resolved.`);\n                if (isNodeBuiltin(warning.source)) {\n                    console.log(chalk.dim(`  '${warning.source}' is a Node.js builtin module that won't exist in the browser.`));\n                    console.log(chalk.dim(`  Find a more web-friendly alternative, or add the \"rollup-plugin-node-polyfills\" plugin to your Snowpack config file.`));\n                }\n                else {\n                    console.log(chalk.dim(`  Make sure that the package is installed and that the file exists.`));\n                }\n                return;\n            }\n            warn(warning);\n        },\n    };\n    const outputOptions = {\n        dir: destLoc,\n        format: 'esm',\n        sourcemap: sourceMap ?? isOptimized,\n        exports: 'named',\n        chunkFileNames: 'common/[name]-[hash].js',\n    };\n    if (Object.keys(installEntrypoints).length > 0) {\n        try {\n            const packageBundle = await rollup(inputOptions);\n            logUpdate(formatInstallResults(skipFailures));\n            await packageBundle.write(outputOptions);\n        }\n        catch (err) {\n            const { loc } = err;\n            if (!loc || !loc.file) {\n                throw err;\n            }\n            // NOTE: Rollup will fail instantly on error. Because of that, we can\n            // only report one error at a time. `err.watchFiles` also exists, but\n            // for now `err.loc.file` has all the information that we need.\n            const failedExtension = path.extname(loc.file);\n            const suggestion = MISSING_PLUGIN_SUGGESTIONS[failedExtension];\n            if (!suggestion) {\n                throw err;\n            }\n            // Display posix-style on all environments, mainly to help with CI :)\n            const fileName = loc.file.replace(cwd + path.sep, '').replace(/\\\\/g, '/');\n            logError(`${chalk.bold('snowpack')} could not import ${fileName}. ${suggestion}`);\n            return;\n        }\n    }\n    if (nomodule) {\n        const nomoduleStart = Date.now();\n        function rollupResolutionHelper() {\n            return {\n                name: 'rename-import-plugin',\n                resolveId(source) {\n                    // resolve from import map\n                    if (importMap.imports[source]) {\n                        return importMap.imports[source];\n                    }\n                    // resolve web_modules\n                    if (source.includes('/web_modules/')) {\n                        const suffix = source.split('/web_modules/')[1];\n                        return { id: path.join(destLoc, suffix) };\n                    }\n                    // null means try to resolve as-is\n                    return null;\n                },\n            };\n        }\n        try {\n            // Strip the replace plugin from the set of plugins that we use.\n            // Since we've already run it once it can cause trouble on a second run.\n            console.assert(inputOptions.plugins[0].name === 'replace');\n            const noModulePlugins = inputOptions.plugins.slice(1);\n            const noModuleBundle = await rollup({\n                input: path.resolve(cwd, nomodule),\n                inlineDynamicImports: true,\n                plugins: [...noModulePlugins, rollupResolutionHelper()],\n            });\n            await noModuleBundle.write({\n                file: path.resolve(destLoc, nomoduleOutput),\n                format: 'iife',\n                name: 'App',\n            });\n            const nomoduleEnd = Date.now() - nomoduleStart;\n            spinner.info(`${chalk.bold('snowpack')} bundled your application for legacy browsers: ${nomoduleOutput} ${chalk.dim(`[${(nomoduleEnd / 1000).toFixed(2)}s]`)}`);\n        }\n        catch (err) {\n            spinner.warn(`${chalk.bold('snowpack')} encountered an error bundling for legacy browsers: ${err.message}`);\n        }\n    }\n    await writeLockfile(path.join(destLoc, 'import-map.json'), importMap);\n    Object.entries(assetEntrypoints).forEach(([assetName, assetLoc]) => {\n        mkdirp.sync(path.dirname(`${destLoc}/${assetName}`));\n        fs.copyFileSync(assetLoc, `${destLoc}/${assetName}`);\n    });\n    return true;\n}\nexport async function cli(args) {\n    // parse CLI flags\n    const cliFlags = yargs(args, { array: ['env', 'exclude', 'externalPackage'] });\n    // if printing help, stop here\n    if (cliFlags.help) {\n        printHelp();\n        process.exit(0);\n    }\n    if (cliFlags.reload) {\n        console.log(`${chalk.yellow('â¹')} clearing CDN cache...`);\n        await clearCache();\n    }\n    // Load the current package manifest\n    let pkgManifest;\n    try {\n        pkgManifest = require(path.join(cwd, 'package.json'));\n    }\n    catch (err) {\n        console.log(chalk.red('[ERROR] package.json required but no file was found.'));\n        process.exit(1);\n    }\n    // load config\n    const { config, errors } = loadConfig(cliFlags, pkgManifest);\n    // handle config errors (if any)\n    if (Array.isArray(errors) && errors.length) {\n        errors.forEach(logError);\n        process.exit(1);\n    }\n    if (cliFlags.source || config.source === 'pika') {\n        console.log(`${chalk.yellow('â¹')} \"source: pika\" mode enabled. Behavior is still experimental and may change before the next major version...`);\n        await clearCache();\n    }\n    // load lockfile\n    let lockfile = await readLockfile(cwd);\n    let newLockfile = null;\n    const { installOptions: { clean, dest, exclude, include }, entrypoints: configEntrypoints, source, webDependencies, } = config;\n    const implicitDependencies = [\n        ...Object.keys(pkgManifest.peerDependencies || {}),\n        ...Object.keys(pkgManifest.dependencies || {}),\n    ];\n    const hasBrowserlistConfig = !!pkgManifest.browserslist ||\n        !!process.env.BROWSERSLIST ||\n        fs.existsSync(path.join(cwd, '.browserslistrc')) ||\n        fs.existsSync(path.join(cwd, 'browserslist'));\n    let isExplicit = false;\n    const installTargets = [];\n    if (configEntrypoints) {\n        isExplicit = true;\n        installTargets.push(...scanDepList(configEntrypoints, cwd));\n    }\n    if (webDependencies) {\n        isExplicit = true;\n        installTargets.push(...scanDepList(Object.keys(webDependencies), cwd));\n    }\n    if (include) {\n        isExplicit = true;\n        installTargets.push(...(await scanImports({ include, exclude })));\n    }\n    if (!isExplicit) {\n        installTargets.push(...scanDepList(implicitDependencies, cwd));\n    }\n    if (installTargets.length === 0) {\n        logError('Nothing to install.');\n        return;\n    }\n    spinner.start();\n    const startTime = Date.now();\n    if (source === 'pika') {\n        newLockfile = await resolveTargetsFromRemoteCDN(installTargets, lockfile, pkgManifest, config).catch((err) => {\n            logError(err.message || err);\n            process.exit(1);\n        });\n    }\n    if (clean) {\n        rimraf.sync(dest);\n    }\n    await mkdirp(dest);\n    const finalResult = await install(installTargets, { hasBrowserlistConfig, isExplicit, lockfile: newLockfile }, config).catch((err) => {\n        if (err.loc) {\n            console.log('\\n' + chalk.red.bold(`â ${err.loc.file}`));\n        }\n        if (err.url) {\n            console.log(chalk.dim(`ð ${err.url}`));\n        }\n        throw err;\n    });\n    if (finalResult) {\n        spinner.succeed(chalk.bold(`snowpack`) +\n            ` installed: ` +\n            formatInstallResults(!isExplicit) +\n            '.' +\n            chalk.dim(` [${((Date.now() - startTime) / 1000).toFixed(2)}s]`));\n        if (!!dependencyStats) {\n            console.log(printStats(dependencyStats));\n        }\n    }\n    if (newLockfile) {\n        await writeLockfile(path.join(cwd, 'snowpack.lock.json'), newLockfile);\n    }\n    // If an error happened, set the exit code so that programmatic usage of the CLI knows.\n    // We were seeing race conditions here, so add a little buffer.\n    if (spinnerHasError) {\n        setTimeout(() => {\n            spinner.warn(chalk(`Finished with warnings.`));\n            process.exitCode = 1;\n        }, 20);\n    }\n}\n"],"names":["CONFIG_NAME","DEFAULT_CONFIG","dedupe","installOptions","clean","hash","dest","exclude","externalPackage","nomoduleOutput","optimize","remoteUrl","stat","strict","env","rollup","plugins","configSchema","type","properties","source","entrypoints","items","webDependencies","additionalProperties","namedExports","babel","include","nomodule","remotePackage","sourceMap","oneOf","id","enum","expandCliFlags","flags","help","version","result","reduce","acc","index","indexOf","key","val","substr","normalizeConfig","config","path","resolve","process","cwd","Array","isArray","isDetailedObject","loadConfig","pkgManifest","cliConfig","explorerSync","cosmiconfigSync","searchPlaces","stopDir","dirname","errors","load","push","search","isEmpty","merge","validation","validate","allowUnknownAttributes","propertyName","overwriteMerge","destinationArray","sourceArray","options","mergedConfig","arrayMerge","map","msg","basename","filepath","toString","PIKA_CDN","CACHE_DIR","cachedir","RESOURCE_CACHE","join","HAS_CDN_HASH_REGEX","readLockfile","lockfileContents","fs","readFileSync","encoding","err","JSON","parse","writeLockfile","loc","importMap","sortedImportMap","imports","Object","keys","sort","writeFileSync","stringify","undefined","fetchCDNResource","resourceUrl","startsWith","got","headers","throwHttpErrors","isTruthy","item","Boolean","resolveDependencyManifest","dep","depManifest","require","paths","code","message","includes","fullPath","searchPath","sep","replace","indexOfSearch","lastIndexOf","manifestPath","substring","length","manifestStr","MISSING_PLUGIN_SUGGESTIONS","resolveDependency","installSpecifier","packageSemver","lockfile","canRetry","validatePackageName","validForNewPackages","installUrl","installUrlType","console","warn","Error","cachedResult","cacache","get","info","catch","metadata","pinnedUrl","statusCode","body","put","importUrlPath","pinnedUrlPath","buildStatus","log","chalk","cyan","lookupStatusCode","resolveTargetsFromRemoteCDN","installTargets","downloadQueue","PQueue","concurrency","newLockfile","resolutionError","allInstallSpecifiers","Set","specifier","installSemver","dependencies","devDependencies","peerDependencies","add","resolvedUrl","onIdle","clearCache","rm","all","CACHED_FILE_ID_PREFIX","PIKA_CDN_TRIM_LENGTH","rollupPluginDependencyCache","name","resolveId","importer","cacheKey","test","response","packageName","split","skipSelf","then","resolved","finalResult","data","IS_DEEP_PACKAGE_IMPORT","rollupPluginEntrypointAlias","packageScope","match","packageFullName","manifest","needsAlias","module","posix","browser","main","rollupPluginDependencyStats","cb","outputDir","existingFileCache","statsSummary","direct","common","buildExistingFileCache","bundle","fileName","filePath","existsSync","size","statSync","compareDependencies","files","contents","byteLength","gzip","zlib","gzipSync","brotli","brotliCompressSync","delta","generateBundle","dir","writeBundle","directDependencies","commonDependencies","assetOrChunk","entries","raw","Buffer","isBuffer","from","rollupPluginTreeshakeInputs","allImports","installTargetsByFile","inputOptions","input","filter","imp","some","fileLoc","treeshakeSummary","summary","default","namespace","named","uniqueNamedImports","normalizedFileLoc","win32","WEB_MODULES_TOKEN","WEB_MODULES_TOKEN_LENGTH","BARE_SPECIFIER_REGEX","HAS_NAMED_IMPORTS_REGEX","SPLIT_NAMED_IMPORTS_REGEX","DEFAULT_IMPORT_REGEX","stripJsExtension","createInstallTarget","removeSpecifierQueryString","queryStringIndex","getWebModuleSpecifierFromCode","d","s","e","parseWebModuleSpecifier","cleanedSpecifier","webModulesIndex","resolvedSpecifier","resolvedSpecifierWithoutExtension","parseImportStatement","webModuleSpecifier","importStatement","ss","se","dynamicImport","defaultImport","namespaceImport","namedImports","trim","getInstallTargetsForFile","scanDepList","depList","whitelistItem","glob","hasMagic","nodeModulesLoc","nodePath","sync","nodir","flat","concat","scanImports","initESModuleLexer","includeFiles","ignore","loadedFiles","Promise","endsWith","promises","readFile","transformFileAsync","runtime","isTSX","babelrc","configFile","dim","impA","impB","localeCompare","SIZE_COLUMN_WIDTH","entriesSort","filenameA","filenameB","formatSize","kb","Math","round","floor","color","padEnd","formatDelta","formatFileInfo","filename","stats","isLastFile","lineGlyph","lineName","fileStat","gzipStat","brotliStat","lineStat","lineDelta","formatFiles","strippedFiles","printStats","dependencyStats","output","allDirect","allCommon","maxFileNameLength","max","bold","underline","values","ALWAYS_SHOW_ERRORS","banner","installResults","spinner","ora","spinnerHasError","printHelp","generateHashFromFile","targetLoc","longHash","hasha","fromFile","algorithm","slice","formatInstallResults","skipFailures","green","yellow","red","logError","stopAndPersist","symbol","fail","logUpdate","text","ErrorWithHint","constructor","hint","PACKAGES_TO_AUTO_DETECT_EXPORTS","detectExports","resolveWebDependency","isExplicit","extname","isJSFile","depManifestLoc","italic","foundEntrypoint","getWebDependencyName","getRollupReplaceKeys","install","hasBrowserlistConfig","isBabel","destLoc","useHash","externalPackages","isOptimized","isStrict","withStats","userDefinedRollup","knownNamedExports","installEntrypoints","assetEntrypoints","installTargetsMap","targetName","targetType","hashQs","t","has","setTimeout","external","treeshake","moduleSideEffects","rollupPluginReplace","url","rollupPluginNodeResolve","mainFields","modulesOnly","extensions","preferBuiltins","rollupPluginJson","preferConst","indent","compact","rollupPluginCommonjs","rollupPluginBabel","presets","babelPresetEnv","modules","targets","rollupPluginTerser","onwarn","warning","isNodeBuiltin","outputOptions","format","sourcemap","exports","chunkFileNames","packageBundle","write","file","failedExtension","suggestion","nomoduleStart","Date","now","rollupResolutionHelper","suffix","assert","noModulePlugins","noModuleBundle","inlineDynamicImports","nomoduleEnd","toFixed","forEach","assetName","assetLoc","mkdirp","copyFileSync","cli","args","cliFlags","yargs","array","exit","reload","configEntrypoints","implicitDependencies","browserslist","BROWSERSLIST","start","startTime","rimraf","succeed","exitCode"],"mappings":"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"}